{% extends "base.html" %}
{% block title %}Screenshot Import - FB Monitor{% endblock %}
{% block content %}
<h1>Import from Screenshots</h1>
<p style="color: var(--text-dim); margin-bottom: 1.5rem;">
    Upload screenshots of Facebook posts and comments. Claude's vision API extracts the text, authors, timestamps, and comments automatically.
</p>

{% if not api_key_set %}
<div style="padding: 1rem; border-radius: 6px; margin-bottom: 1.5rem;
            background: #3a2a20; border: 1px solid var(--orange); color: var(--orange);">
    Anthropic API key not configured. Add <code>"anthropic_api_key"</code> to config.json or set the
    <code>ANTHROPIC_API_KEY</code> environment variable.
</div>
{% endif %}

{% if message %}
<div style="padding: 0.75rem 1rem; border-radius: 6px; margin-bottom: 1rem;
            background: {% if message_type == 'error' %}#3a2020{% else %}#1a2e1a{% endif %};
            border: 1px solid {% if message_type == 'error' %}var(--red){% else %}var(--green){% endif %};
            color: {% if message_type == 'error' %}var(--red){% else %}var(--green){% endif %};">
    {{ message }}
</div>
{% endif %}

<div class="card">
    <form method="post" action="/screenshots/parse" enctype="multipart/form-data" id="upload-form">
        <div style="margin-bottom: 0.75rem;">
            <label style="font-size: 0.85rem; color: var(--text-dim);">Screenshots (PNG, JPG — select multiple)</label>
            <input type="file" name="files" accept="image/*" multiple required
                style="display: block; margin-top: 0.5rem; background: var(--surface2); border: 1px solid var(--border);
                       color: var(--text); padding: 0.5rem; border-radius: 6px; width: 100%; font-size: 0.9rem;">
        </div>
        <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
            <div>
                <label style="font-size: 0.85rem; color: var(--text-dim);">Page name (helps accuracy)</label>
                <input type="text" name="page_name" placeholder="e.g. Vote Kevin Crye"
                    style="background: var(--surface2); border: 1px solid var(--border); color: var(--text);
                           padding: 0.5rem 0.75rem; border-radius: 6px; font-size: 0.9rem;">
            </div>
            <div>
                <label style="font-size: 0.85rem; color: var(--text-dim);">Page URL (optional)</label>
                <input type="text" name="page_url" placeholder="https://facebook.com/pagename"
                    style="background: var(--surface2); border: 1px solid var(--border); color: var(--text);
                           padding: 0.5rem 0.75rem; border-radius: 6px; font-size: 0.9rem; width: 300px;">
            </div>
            <button type="submit" id="parse-btn" {% if not api_key_set %}disabled{% endif %}
                style="background: var(--accent); color: white; border: none; padding: 0.5rem 1.25rem;
                       border-radius: 6px; cursor: pointer; font-size: 0.9rem; margin-top: 1.2rem;
                       {% if not api_key_set %}opacity: 0.5; cursor: not-allowed;{% endif %}">
                Parse Screenshots
            </button>
        </div>
    </form>
</div>

<details class="card" style="cursor: pointer;">
    <summary style="font-weight: 600; font-size: 0.95rem; color: var(--accent); user-select: none;">
        Tips for best results
    </summary>
    <div style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-dim); line-height: 1.7;">
        <ul style="padding-left: 1.5rem;">
            <li>Take full-width screenshots — don't crop too tightly</li>
            <li>Include the post author name and timestamp in the screenshot</li>
            <li>For long posts with many comments, take multiple screenshots scrolling down — upload them together and they'll be merged</li>
            <li>"See more" links should be clicked before screenshotting to capture full text</li>
            <li>Each screenshot can contain one or multiple posts</li>
            <li>You can review and edit all extracted data before saving</li>
        </ul>
    </div>
</details>

<script>
document.getElementById('upload-form').addEventListener('submit', function() {
    const btn = document.getElementById('parse-btn');
    btn.textContent = 'Parsing...';
    btn.disabled = true;
    btn.style.opacity = '0.6';
});
</script>
{% endblock %}
